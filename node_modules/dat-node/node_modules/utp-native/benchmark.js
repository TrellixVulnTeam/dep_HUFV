var utp = require('utp-native')
var speedometer = require('speedometer')
var zero = require('dev-zero-stream')

var server = utp.createServer(function (socket) {
  var speed = speedometer()

  socket.on('data', function (data) {
    console.log('<--', data.length)
    speed(data.length)
  })

  setInterval(function () {
    console.log(speed())
  }, 1000)
})

server.listen(function () {
  var socket = server.connect(server.address().port)

  zero().pipe(socket)
})
